<p id="notice"><%= notice %></p>

<% if current_user.shopkeeper? && current_user.is_establshment_present(@establishment)%>
	<%= link_to 'Apagar Estabelecimento', @establishment, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger float-left mb-2' %>
	<section class="float-right mb-2">
		<%= link_to 'Editar Estabelecimento', edit_establishment_path(@establishment), class: 'btn btn-info' %>
	</section>
<% end %>

<section class="establishment_photo">
	<% if @establishment.photo.present? %>
		<%= image_tag @establishment.photo %>
	<% else %>
		<%= image_tag 'no-photo' %>
	<% end %>
</section>

<section class="about_establishment mt-3">
	<h4><%= @establishment.name %></h4>

	<hr>

	<section class="items">
		<section class="row">
			<section class="col-3 call">
				<%= image_tag 'call' %>
			</section>

			<section class="col-3 place">
				<%= image_tag 'place' %>
			</section>

			<section class="col-3 star">
				<%= image_tag 'star' %>
			</section>

			<section class="col-3 world">
				<%= image_tag 'world' %>
			</section>
		</section>
	</section>

	<section class="establishment_icons_background">
		<section class="close offset-10">
			<%= image_tag 'close_tab' %>
		</section>

		<section class="establishment_icons_information">
			<section class="telephone mt-3">
				<h4>Telefone:</h4>

				<% if @establishment.telephone.present? %>
					<%= @establishment.telephone %>
				<% else %>
					Não há um telefone cadastrado até o momento.
				<% end %>
			</section>

			<section class="address mt-3">
				<h4>Endereço:</h4>
				<table class="table">
					<% if @establishment.addresses.count > 0 %>
						<% @establishment.addresses.each do |address| %>
							<tr>
								<td><b>Cidade:</b> <br> <%= address.establishment_city.city.name %></td>
								<td colspan="2"><b>Rua:</b> <br> <%= address.street %></td>
							</tr>

							<tr>
								<td><b>Bairro:</b> <br> <%= address.neighborhood %></td>
								<td><b>Número:</b> <br> <%= address.number %></td>
								<td><b>CEP:</b> <br> <%= address.cep %></td>
							</tr>

							<tr><td colspan="3"></tr>
						<% end %>
					<% else %>
						Endereço indisponível.
					<% end %>
				</table>
			</section>

			<section class="rating mt-3">
				<h4>Avaliação:</h4>

				<% if @establishment.rating.present? %>
					<% (1..@establishment.get_rating).each do |i| %>
                 	 	<%= image_tag 'rating' %>
                	<% end %>
				<% else %>
					Não há avaliações ainda. <%= image_tag 'sad' %>
				<% end %>

				<%= form_for(@establishment, url: update_rating_establishment_path) do |f| %>
					Dê a sua avaliação:
					<%= f.number_field :rating, min: 1, class: 'form-control' %>
					<small>1 - Ruim | 2 - Médio | 3 - Bom | 4 - Muito Bom | 5 Excelente</small>

					<br>
					
					<%= f.submit 'Avaliar', class: 'btn btn-primary' %>
				<% end %>
			</section>

			<section class="social mt-3">
				<h4>Redes Sociais:</h4>
				<br>
				<section class="row">
					<section class="col-3">
						<%= link_to @establishment.facebook do %>
							<%= image_tag 'facebook' %>
						<% end %>
					</section>

					<section class="col-3">
						<%= link_to @establishment.instagram do %>
							<%= image_tag 'instagram-sketched' %>
						<% end %>
					</section>

					<section class="col-3">
						<%= link_to @establishment.whatsapp do %>
							<%= image_tag 'whatsapp' %>
						<% end %>
					</section>

					<section class="col-3">
						<%= link_to @establishment.website do %>
							<%= image_tag 'internet' %>
						<% end %>
					</section>
				</section>
			</section>	
		</section>
	</section>

	<br><br>

	<section class="about">
		<h5>Um pouco sobre a gente</h5>

		<hr>

		<section class="description">
			<%= @establishment.description %>
		</section>
	</section>

	<br>

	<section class="additional_information mt-4">
		<h5>Informações Adicionais <%= image_tag 'menu' %></h5>

		<hr>

		<section class="description">
			<%= @establishment.additional_information %>
		</section>
	</section>

	<% if current_user.shopkeeper? && current_user.is_establshment_present(@establishment)%>
		<section class="cities mt-4">
			<h5>Cidades Atuantes</h5>

			<section class="description">
				<% @establishment.cities.each do |city| %>
					<%= city.name %> <br>
				<% end %>
			</section>
		</section>

		<section class="addresses mt-4">
			<h5>Endereços</h5>

			<section class="description">
				<% if @establishment.addresses.count > 0 %>
					<section class="table_mobile">
						<table class="table table-hover">
							<% @establishment.addresses.each do |address| %>
								<tr>
									<td colspan="5"><%= address.establishment_city.city.name %></td>
									<td><%= link_to 'Editar', edit_address_path(address, establishment: @establishment) %></td>
									<td><%= link_to 'Apagar', address, method: :delete, data: { confirm: 'Are you sure?' } %></td>
								</tr>
							<% end %>
						</table>
					</section>

					<hr>

					<%= link_to 'Cadastrar Endereço', new_address_path(establishment: @establishment), class: 'btn btn-info' %>
				<% else %>	
					Não existem endereços cadastrados <hr>
					<%= link_to 'Cadastrar Endereço', new_address_path(establishment: @establishment), class: 'btn btn-info' %>
				<% end %>
			</section>
		</section>
	<% end %>
</section>

<%= link_to 'Voltar', (current_user.client?) ? establishments_path : current_user_establishments_establishments_path, class: 'btn btn-warning mt-4'  %>